---
title: "자바스크립트의 핵심, 실행 컨텍스트"
date: "2020-10-23"
tags: ["javascript"]
---

**자바스크립트의 핵심, 실행 컨텍스트는 자바스크립트 엔진의 동작원리를 담고 있는 핵심이다.**

## 실행 컨텍스트란?

**_"실행 가능한 코드를 형상화하고 구분적인 추상적인 개념."_** 이다. 설명이 이해가 안될 수도 있다. 조금더 쉽게 설명하자면,

**_"실행 가능한 코드가 실행되기 위해 필요한 환경."_** 이다... 어려울 수 있지만 읽어보며 파악해보자.

**실행 가능한 코드란**

    - 전역 코드: 전역 영역에 존재하는 코드
    - Eval 코드: eval 함수로 실행되는 코드
    - 함수 코드: 함수 내에 존재하는 코드

## 실행 컨텍스트의 3가지 객체

실행컨텍스트는 물리적으로 객체의 형태를 가지며 아래의 3가지 프로퍼티를 소유한다.

### Variable Object(변수 객체)

객체에 담긴 정보

    - 변수
    - 매개변수와 인수 정보
    - 함수 선언(함수 표현식 제외)

_이제부턴 줄여서 VO라고 부르겠다._

VO의 값들은 다른 객체를 가리키는데 전역 컨텍스트의 경우와 함수를 실행할 때 생성되는 함수 컨텍스트의 경우가 다르다!

**전역 컨텍스트의 경우**

- VO는 유일하며 최상위에 위치한다. 모든 전역 변수, 전역 함수등을 포함하는 GO(Global Object/전역 객체)를 가리킨다. 전역 객체는 전역에 선언된 전역 변수와 전역 함수를 프로퍼티로 소유한다.

  **함수 컨텍스트의 경우**

- VO는 AO( Activation Object/활성 객체)를 가리키며 매개변수와 인수들의 정보를 배열의 형태로 담고 있는 객체인 arguments object가 추가된다.

### Scope Chain (SC)

스코프 체인!, 말만 들어도 살짝 감이 오지 않는가? 게임을 많이 했던 사람들은 알 것 이다. 총 위에 달린 스코프(나만 이렇게 생각할 수도 있다.)와 비슷(?) 할 수도 있다. 간단하게 설명하면 아래와 같은 것들이 있다.

    - 지역 스코프(어떤 지역(함수)안에 있는 변수나 함수들을 가리킨다)
    - 전역 스코프(전역에 있는 변수나 함수들을 가리킨다)

스코프에 대한 이야기는 다음 시간에 자세히 다뤄보도록하고 스코프 체인은 말그대로 이 스코프들이 엮여 있는 것이다. 스코프 체인은 일종의 리스트인데 전역 객체(GO) 또는 활성 객체(AO)를 저장하고 있는 리스트이다.

이 스코프체인은 현재 실행 컨텍스트의 AO를 선두로 순차적으로 상위 AO로 올라간다. 마지막엔 (GO)를 가리키겠지? 바로 이것이 어느 지역 안에서는 밖에 있는 변수나 함수를 쓸 수 있고 지역 밖에선 그 안에 있는 것들을 못쓰게 만든다고 볼 수 있다.

### this value

this 프로퍼티에는 this 값이 할당된다. 할당되는 값은 함수 호출 패턴에 의해 결정된다. this로도 할 말이 많으니 다음에 자세히 다뤄보도록 하겠다.

## 실행 컨텍스트의 생성 과정

간단하게 생성 과정을 쭉 훑어보도록 하겠다.(사실 간단하지 않다)

먼저, 컨트롤이 실행 컨텍스트에 진입하기 이전에 유일한 GO가 생성된다. 이 객체의 프로퍼티는 코드의 어떠한 곳에서도 접근할 수 있다. 초기상태엔 기본적으로 js의 기본 객체(Math,String,Array 등)와 BOM,DOM이 설정되어 있다.

이 후, 전역 코드로 컨트롤이 진입하면 전역 실행 컨텍스트를 선두로 스택이 쌓이기 시작한다.

그 이 후는 아래와 같이 처리가 진행된다.(이 과정은 불변이다)

     1. 스코프 체인의 생성과 초기화
     2. 변수 객체화 실행
     3. this value의 결정

### 스코프 체인의 생성과 초기화

가장 먼저, 스코프 체인의 생성과 초기화가 실행된다. 맨 처음 스코프 체인은 전역 객체의 참조를 포함하는 리스트이다.

### 변수 객체화 실행

여기부터 좀 복잡하고 핵심의 시작이다.. 아래의 순서로 VO에 프로퍼티와 값을 set한다. (불변인 것을 기억해라)

    1. (Function Code인 경우) 매개변수(인자값 or 파라미터)가 VO의 프로퍼티로, 인수가 값으로 설정된다.
    2. 대상 코드 내의 함수 선언(함수 표현식 제외)의 함수명이 VO의 프로퍼티로, 생성된 함수 객체가 값으로 설정된다.
    3. 대상 코드 내의 변수 선언을 대상으로 변수명이 VO의 프로퍼티로, undefined가 값으로 설정된다.

위의 2번과 3번 같은 경우를 뭐라 그러는지 모를 것이다.

저게 바로 js를 사용하는 사람들이 힘들어 하는 것 중 하나인 호이스팅이다! 뜨하핳

밑에 코드를 보자.

```javascript
var a = "이러쿵";

function foo() {
  var b = "저러쿵";
  function bar() {
    var c = "이저러쿵";
    console.log(a);
  }
  bar();
}
foo();
```

위 순서대로 위 코드는 foo가 a보다 먼저 선언된다. 잘 알아두자.

#### foo의 선언 처리

일단 함수 선언은 Variable Object(전역 코드인 경우 Global Object)의 프로퍼티로, 생성된 함수 객체가 값으로 설정된다. 이 함수는 [[Scopres]] 라는 함수 객체만이 소유하는 내부 프로퍼티를 소유하게 된다. 위에 잠깐 설명했듯이 이 스코프란 녀석은

**함수 객체가 실행되는 환경**을 가리킨다.

스코프 프로퍼티는 현재 실행 컨텍스트의 스코프 체인이 참조하고 있는 객체를 값으로 설정한다. 내부 함수의 스코프 프로퍼티는 자기 자신의 실행환경(Lexical Environment)과 자신을 포함하는 외부 함수의 실행 환경과 전역 객체를 가리키는데, 자신을 포함하는 외부 함수의 실행 컨텍스트가 소멸하여도 가리키고 있던 외부 함수의 실행환경을 그대로 참조할 수 있다.(?!?!!?)

이것이 바로 **클로저**다.

클로저라는 개념을 외우려하지 말고 이해해라. 이런 것이다... (실행 컨텍스트를 정말 열심히 보다보면 그동안 어려웠던 개념들을 단!번!에 이해할 수 있다.)

#### 함수 표현식

지금까지의 과정은 코드가 실행되기 이전, 환경설정과 같은 것이다. 이 때 이미 변수 객체에 함수(foo)가 등록되어 있으므로 코드를 실행할때 호이스팅이 적용되어서 한수선언식(foo) 이전에 함수를 호출가능 한 것이다. 위에서 말한 호이스팅을 다시 잠깐 설명하자면, 함수 표현식은 3번인 변수로 취급한다. 선언식과 다르다는 것을 명심해라.

#### 변수 a의 처리

일반적으로 변수 선언은

    1. 선언 단계(VO에 변수등록, 이 변수 객체는 스코프가 참조할 수 있는 대상이 된다.)
    2. 초기화 단계(VO에 등록된 변수를 메모리에 할당, 이 단계에서 변수는 undefined로 초기화)
    3. 할당 단계(실제값을 변수에 할당 a의 경우 "이러쿵")

여기서 var 키워드로 선언된 변수는 1,2단계가 한 번에 이루어진다. 때문에 변수 선언문 이전에 접근하여도 에러가 발생하지 않지만 undefined를 반환한다. 이러한 문제를 해결하기 위해서 let,const등 es6에서 나온 키워드들이 존재한다.

### this value 결정

this value가 결정되기 이전에 this는 전역 객체를 가리키고 있다가 함수 호출 패턴에 의해 this에 할당되는 값이 결정된다. 전역 코드의 경우, this는 전역 객체를 가리킨다. 전역 컨텍스트(전역 코드)의 경우, VO, 스코프 체인, this 값은 언제나 전역 객체이다.

이렇게 실행 컨텍스트의 개념과 생성과정을 알아보았다. 여기까지 이해하면서 정리하는데 2시간이나 걸렸다... 호이스팅,this,스코프,클로저 알고보면 이렇게 전부 관련이 있는 녀석들이니 따로 보지말고 쭉 보면서 이해하면 이해가 될 것이다.

여기에 부수적인건 차차 다루도록 하겠다. 나름 정리라고 한거지만 되었는지 모르겠다 ㅠㅠ 다들 화이팅

**참고**

https://poiemaweb.com/js-execution-context

그럼 오늘도
**_just do it!_**
